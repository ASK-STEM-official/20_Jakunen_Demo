# データベーススキーマ定義書
## Admins（管理者）

| カラム名     | データ型      | 制約         | 説明                   |
| ------------ | ------------- | ------------ | ---------------------- |
| AdminID      | INT           | PK, IDENTITY | 管理者ID               |
| Username     | NVARCHAR(50)  | NOT NULL     | ログイン名             |
| PasswordHash | NVARCHAR(255) | NOT NULL     | パスワード（ハッシュ） |
| FullName     | NVARCHAR(100) | NOT NULL     | 氏名                   |
| Email        | NVARCHAR(100) | NULL         | メールアドレス         |

## Products（商品）

| カラム名       | データ型      | 制約                   | 説明                     |
| -------------- | ------------- | ---------------------- | ------------------------ |
| ProductID      | INT           | PK, IDENTITY           | 商品ID                   |
| ProductName    | NVARCHAR(255) | NOT NULL               | 商品名                   |
| Price          | DECIMAL(10,2) | NOT NULL               | 税抜単価                 |
| Stock          | INT           | NOT NULL               | 在庫数                   |
| CategoryID     | INT           | FK → ProductCategories | 商品カテゴリID           |
| AlertThreshold | INT           | NULL                   | 在庫アラートしきい値     |
| Description    | NVARCHAR(MAX) | NULL                   | 商品説明                 |
| IsPublished    | BIT           | NOT NULL DEFAULT 1     | 出品中フラグ（0:停止中） |

## ProductCategories（商品カテゴリ）

| カラム名     | データ型      | 制約                   | 説明          |
| ------------ | ------------- | ---------------------- | ------------- |
| CategoryID   | INT           | PK, IDENTITY           | カテゴリID    |
| CategoryName | NVARCHAR(100) | NOT NULL               | カテゴリ名    |
| TaxRate      | DECIMAL(4,2)  | NOT NULL DEFAULT 10.00 | 消費税率（%） |

## Customers（顧客）

| カラム名      | データ型      | 制約         | 説明                 |
| ------------- | ------------- | ------------ | -------------------- |
| CustomerID    | INT           | PK, IDENTITY | 顧客ID               |
| CustomerName  | NVARCHAR(255) | NOT NULL     | 氏名                 |
| PhoneNumber   | NVARCHAR(50)  | NOT NULL     | 電話番号             |
| Address       | NVARCHAR(MAX) | NOT NULL     | 住所                 |
| Registered_at | DATETIME      | NOT NULL     | ECサイトへの登録日時 |

## OrderReservations（受注ヘッダー）

- ShippingAddressはデフォルトの値を取らない時のみ使用。

| カラム名            | データ型      | 制約     | 説明           |
| ------------------- | ------------- | -------- | -------------- |
| ReservationID       | NVARCHAR(50)  | PK       | 発注予約ID     |
| ReservationDateTime | DATETIME      | NOT NULL | 予約日時       |
| CustomerID          | INT           | FK       | 顧客ID         |
| TotalAmount         | DECIMAL(10,2) | NULL     | 合計金額       |
| ShippingAddress     | NVARCHAR(MAX) | NULL     | 配送先住所     |
| PaymentMethod       | NVARCHAR(50)  | NULL     | 支払方法       |
| Status              | NVARCHAR(50)  | NOT NULL | ステータス     |
| ImportedDateTime    | DATETIME      | NULL     | インポート日時 |

## OrderReservationItems（受注明細）

| カラム名      | データ型      | 制約         | 説明                |
| ------------- | ------------- | ------------ | ------------------- |
| ItemID        | INT           | PK, IDENTITY | 明細ID              |
| ReservationID | NVARCHAR(50)  | FK           | 発注予約ID          |
| ProductID     | INT           | FK, NOT NULL | 商品ID              |
| ProductName   | NVARCHAR(255) | NOT NULL     | 商品名（履歴用）    |
| Quantity      | INT           | NOT NULL     | 注文数量            |
| UnitPrice     | DECIMAL(10,2) | NOT NULL     | 注文時の単価        |
| Subtotal      | DECIMAL(10,2) | NOT NULL     | 小計（単価 × 数量） |

## OrderStatusHistory（受注ステータス履歴）

| カラム名         | データ型     | 制約         | 説明             |
| ---------------- | ------------ | ------------ | ---------------- |
| HistoryID        | INT          | PK, IDENTITY | 履歴ID           |
| ReservationID    | NVARCHAR(50) | FK           | 発注予約ID       |
| StatusFrom       | NVARCHAR(50) | NULL         | 変更前ステータス |
| StatusTo         | NVARCHAR(50) | NOT NULL     | 変更後ステータス |
| ChangeDateTime   | DATETIME     | NOT NULL     | 変更日時         |
| ChangedByAdminID | INT          | FK           | 操作した管理者ID |

## Alertlogs（在庫アラート）

| カラム名     | データ型 | 制約         | 説明                     |
| ------------ | -------- | ------------ | ------------------------ |
| AlertID      | INT      | PK, IDENTITY | アラートID               |
| ProductID    | INT      | FK           | 対象商品ID               |
| DetectedAt   | DATETIME | NOT NULL     | アラート発生日時         |
| StockAtAlert | INT      | NULL         | アラート時の在庫数       |
| IsResolved   | BIT      | DEFAULT 0    | 対応済フラグ（0:未対応） |
